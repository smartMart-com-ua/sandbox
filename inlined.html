<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>sandbox/inlined.html</title>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<!-- current test -->
	<!-- <script src="https://smartmartcomuasandbox.bitbucket.io/ShatskyBBQ/extraField.test-0.1.x.js"></script> -->
	<!-- <link rel="stylesheet" href="https://smartmartcomuasandbox.bitbucket.io/ShatskyBBQ/extraField.test-0.1.x.css"> -->
	<!-- sbModJs-0.1.3.min test -->
	<!-- <link rel="stylesheet" href="https://smartmartcomuasandbox.bitbucket.io/ShatskyBBQ/sbModJs-0.1.3.min.css"> -->
	<script src="https://smartmartcomuasandbox.bitbucket.io/ShatskyBBQ/sbModJs-0.1.3.min.js"></script>
</head>
<body>
	<!-- START sbModJs-0.1.3.* direct code -->
	<style type="text/css">
		/* sbModJs CSS sbMod-0.1.3.css */
		.ec-form__cell.ec-form__cell--country,.ec-form__cell.ec-form__cell--company-name,.ec-form__cell.ec-form__cell--city,.ec-form__cell.ec-form__cell--postalcode{display:none !important}
		.ec-form__cell.ec-form__cell--sbMod_deliverySlot .form-control .form-control__text{width:2.75rem !important;font-weight:bold;text-align:end;padding-right:2px !important}
		.ec-form__cell.ec-form__cell--sbMod_deliverySlot .sbModJs_deliverySlotVisualized{color:#000;vertical-align:middle !important}
		.ec-form__cell.ec-form__cell--sbMod_deliverySlot .sbModJs_deliverySlotVisualized>span{margin-left:1rem !important}
	</style>
	<script type="text/javascript">
		/* sbModJs JS sbMod-0.1.3.min.js */
		window.ec=window.ec||{};window.sbModJs=window.sbModJs||{};sbModJs.version="0.1.3p-min";sbModJs.msgHdr="[sbModJs]";
sbModJs.dsConfig={
	dTitle:"Дата доставки*",
	dTip:"Укажите дату, когда вы хотите получить заказ",
	dNextDayOrderHour:12,
	dMaxMonthes:2,
	tTitle:"Время доставки* (3-х часовой интервал)",
	tTip:"Укажите начало желаемого промежутка времени, мы покажем весь интервал",
	tSlotInitial:9,
	tSlotDuration:3,
	tplDeliveryTimeSlotVizualize:"<strong> : 00 — {{slotEnd}} : 00 ч</strong>",
	tplDeliveryTimeSlotEmptyVizualize:"<span>время доставки не выбрано</span>",
	tplDeliveryDateSlot:"[{{deliveryDateString}}] {{deliveryTimeString}}",
	tplDeliveryTimeSlot:"{{slotStart}}:00 - {{slotEnd}}:00 ч"
};sbModJs.page={type:void 0,hasPrevious:!1};sbModJs.cart={};sbModJs.tickTime=750;console.log(sbModJs.msgHdr,"version:",sbModJs.version);
function sbModJs_uxUIsetupProvinceSelect(){if("CHECKOUT_ADDRESS"===sbModJs.page.type){var a=document.querySelector(".form-control--type-state select");if(null==a)console.info(sbModJs.msgHdr,"sbModJs_uxUIsetupProvinceSelect():","no provinceSelect found, reticked"),setTimeout(function(){sbModJs_uxUIsetupProvinceSelect()},sbModJs.tickTime);else if(console.info(sbModJs.msgHdr,"sbModJs_uxUIsetupProvinceSelect():","provinceSelect found, options.length:",a.options.length),85>a.options.length||"77"!==a.options[1].value)console.info(sbModJs.msgHdr,
"sbModJs_uxUIsetupProvinceSelect():","looks like no valid provinceSelect options loaded yet, reticked"),setTimeout(function(){sbModJs_uxUIsetupProvinceSelect()},sbModJs.tickTime);else{console.info(sbModJs.msgHdr,"sbModJs_uxUIsetupProvinceSelect():","looks like valid provinceSelect options already here, options length:",a.options.length,"[1].value:",'"'+a.options[1].value+'"',"[1].innerText:",'"'+a.options[1].innerText+'"');for(var b=0;b<a.options.length;b++)""!==a.options[b].value&&"77"!==a.options[b].value&&
"50"!==a.options[b].value&&(a.options[b].style.display="none",a.options[b].disabled=!0,a.options[b].hidden=!0);Ecwid.refreshConfig();console.info(sbModJs.msgHdr,"sbModJs_uxUIsetupProvinceSelect():","provinceSelect unwanted options hidden");console.log(sbModJs.msgHdr,"sbModJs_uxUIsetupProvinceSelect():","done")}}}
function sbModJs_uxUIsetupDeliveryTimeSlot(){if("CHECKOUT_ADDRESS"===sbModJs.page.type){var a=document.querySelector(".ec-form__cell--sbMod_deliverySlot input");null==a?(console.info(sbModJs.msgHdr,"sbModJs_uxUIsetupDeliveryTimeSlot():","no deliverySlotInput found, reticked"),setTimeout(function(){sbModJs_uxUIsetupDeliveryTimeSlot()},sbModJs.tickTime)):(console.info(sbModJs.msgHdr,"sbModJs_uxUIsetupDeliveryTimeSlot():","deliverySlotInput found, value:",'"'+a.value+'"'),"number"==$(a).attr("type")?
console.info(sbModJs.msgHdr,"sbModJs_uxUIsetupDeliveryTimeSlot():","deliverySlotInput ready"):(console.info(sbModJs.msgHdr,"sbModJs_uxUIsetupDeliveryTimeSlot():","deliverySlotInput not yet ready, prepare..."),$(a).removeAttr("maxlength").attr({type:"number",min:0,max:23}),$(a).after($("<span>").addClass("sbModJs_deliverySlotVisualized")),sbModJs_vizualizeDeliveryTimeSlot()))}}
function sbModJs_uxUIorderConfirmation(){if("ORDER_CONFIRMATION"===sbModJs.page.type){var a=document.querySelector(".ec-confirmation__step--deliveryinstructionsinfo .ec-confirmation__section");if(null==a)console.info(sbModJs.msgHdr,"sbModJs_uxUIorderConfirmation():","no deliveryInstructionSection found, reticked"),setTimeout(function(){sbModJs_uxUIorderConfirmation()},sbModJs.tickTime);else{console.info(sbModJs.msgHdr,"sbModJs_uxUIorderConfirmation():","deliveryInstructionSection found, fixing...");
var b=a.innerText.replace(/, 00000$/,""),c="PSecwid__"+sbModJs.storeId+"PSorderResult";localStorage&&localStorage.hasOwnProperty(c)?(console.log(sbModJs.msgHdr,"sbModJs_uxUIorderConfirmation():","localStorage data found"),c=JSON.parse(localStorage[c]),c.hasOwnProperty("confirmation")&&c.confirmation.hasOwnProperty("order")&&c.confirmation.order.hasOwnProperty("shippingPerson")&&c.confirmation.order.shippingPerson.hasOwnProperty("companyName")?(c=c.confirmation.order.shippingPerson.companyName,console.log(sbModJs.msgHdr,
"sbModJs_uxUIorderConfirmation():","localStorage companyName data:",c),a.innerText=b+("\n"+c),console.log(sbModJs.msgHdr,"sbModJs_uxUIorderConfirmation():","deliveryInstructionSection fixed")):console.log(sbModJs.msgHdr,"sbModJs_uxUIorderConfirmation():","localStorage no companyName data found")):console.log(sbModJs.msgHdr,"sbModJs_uxUIorderConfirmation():","no localStorage data");console.log(sbModJs.msgHdr,"sbModJs_uxUIorderConfirmation():","done")}}}
function sbModJs_updateCompanyNameField(){Ecwid.Cart.get(function(a){console.debug(sbModJs.msgHdr,"sbModJs_updateCompanyNameField():","cart.shippingPerson.companyName:",a.shippingPerson.companyName);a=a.shippingPerson;var b="",c="";if(ec&&ec.order&&ec.order.extraFields){console.log(sbModJs.msgHdr,"sbModJs_updateCompanyNameField():","ec.order.extraFields found");var f="PSecwid__"+sbModJs.storeId+"PScart";if(localStorage.hasOwnProperty(f))if(console.log(sbModJs.msgHdr,"sbModJs_updateCompanyNameField():",
"localStorage data found"),f=JSON.parse(localStorage[f]),f.hasOwnProperty("order")&&f.order.hasOwnProperty("orderExtraFields")){console.log(sbModJs.msgHdr,"sbModJs_updateCompanyNameField():","localStorage orderExtraFields data found");for(var e in ec.order.extraFields){var d=f.order.orderExtraFields[e].value;"sbMod_deliveryDate"==e&&(console.log(sbModJs.msgHdr,"sbModJs_updateCompanyNameField():","sbMod_deliveryDate from localStorage:",d),b=d.match(/^(\d+)-(\d+)-(\d+)/),b=b[3]+"-"+b[2]+"-"+b[1]);"sbMod_deliverySlot"==
e&&(console.log(sbModJs.msgHdr,"sbModJs_updateCompanyNameField():","sbMod_deliverySlot from localStorage:",d),c=parseInt(d),d=c+sbModJs.dsConfig.tSlotDuration,d=23<d?d-24:d,c=sbModJs.dsConfig.tplDeliveryTimeSlot.replace("{{slotStart}}",c).replace("{{slotEnd}}",d))}e=sbModJs.dsConfig.tplDeliveryDateSlot.replace("{{deliveryDateString}}",b).replace("{{deliveryTimeString}}",c);console.log(sbModJs.msgHdr,"sbModJs_updateCompanyNameField():","companyName field to update:",e);a.companyName=e;Ecwid.Cart.setAddress(a);
console.log(sbModJs.msgHdr,"sbModJs_updateCompanyNameField():","updated")}else console.log(sbModJs.msgHdr,"sbModJs_updateCompanyNameField():","no localStorage orderExtraFields data");else console.log(sbModJs.msgHdr,"sbModJs_updateCompanyNameField():","no localStorage data")}else console.log(sbModJs.msgHdr,"sbModJs_updateCompanyNameField():","no ec.order.extraFields")})}
function sbModJs_uxUIcheckoutDelivery(){if("CHECKOUT_DELIVERY"===sbModJs.page.type){var a=document.querySelector(".ec-cart-step--address.ec-cart-step--done .ec-cart-step__text");if(null==a)console.info(sbModJs.msgHdr,"sbModJs_uxUIcheckoutDelivery():","no addressSection found, reticked"),setTimeout(function(){sbModJs_uxUIcheckoutDelivery()},sbModJs.tickTime);else{console.info(sbModJs.msgHdr,"sbModJs_uxUIcheckoutDelivery():","addressSection found, fixing...");var b=a.innerText.replace(/, 00000$/,"");
a.innerText=b;console.log(sbModJs.msgHdr,"sbModJs_uxUIcheckoutDelivery():","addressSection fixed");console.info(sbModJs.msgHdr,"sbModJs_uxUIcheckoutDelivery():","done")}}}
function sbModJs_OnPageLoaded(a){console.log(sbModJs.msgHdr,"sbModJs_OnPageLoaded():","started");sbModJs.page=a;switch(sbModJs.page.type){case "CHECKOUT_ADDRESS":console.log(sbModJs.msgHdr,"sbModJs_OnPageLoaded():","case:",sbModJs.page.type);sbModJs_uxUIsetupProvinceSelect();sbModJs_uxUIsetupDeliveryTimeSlot();break;case "CHECKOUT_DELIVERY":console.log(sbModJs.msgHdr,"sbModJs_OnPageLoaded():","case:",sbModJs.page.type);sbModJs_updateCompanyNameField();sbModJs_uxUIcheckoutDelivery();break;case "ORDER_CONFIRMATION":console.log(sbModJs.msgHdr,
"sbModJs_OnPageLoaded():","case:",sbModJs.page.type);sbModJs_uxUIorderConfirmation();break;default:console.log(sbModJs.msgHdr,"sbModJs_OnPageLoaded():",sbModJs.page.type,"case: default")}console.log(sbModJs.msgHdr,"sbModJs_OnPageLoaded():","done")}
function sbModJs_OnCartChanged(a){sbModJs.cart=a;console.info(sbModJs.msgHdr,"sbModJs_OnCartChanged():","sbModJs.cart refreshed");console.debug(sbModJs.msgHdr,"sbModJs_OnCartChanged():","sbModJs.cart:",sbModJs.cart);console.info(sbModJs.msgHdr,"sbModJs_OnCartChanged():","no postprocess for:",sbModJs.page.type)}
function sbModJs_OnDeliverySlotInput(a){var b=a.target.value;a=parseInt(b);a=""===b?"":isNaN(a)||0>a?"":a%24;console.info(sbModJs.msgHdr,"sbModJs_OnDeliverySlotInput():","slotStart out:",a,typeof a);b=document.querySelector(".ec-form__cell--sbMod_deliverySlot input");b.value=a;b.dispatchEvent(new Event("input"));sbModJs_vizualizeDeliveryTimeSlot()}
function sbModJs_CalcMinDate(){var a=new Date,b=a.getFullYear(),c=a.getMonth(),f=a.getDate(),e=a.getHours();a=a.getMinutes();b=new Date(b,c,f+(e>=sbModJs.dsConfig.dNextDayOrderHour||e==sbModJs.dsConfig.dNextDayOrderHour&&0<a?2:1));console.log(sbModJs.msgHdr,"sbModJs_CalcMinDate():","minDate:",b);return b}
function sbModJs_CalcMaxDate(){var a=new Date,b=a.getFullYear(),c=a.getMonth();a=a.getDate();b=new Date(b,c+sbModJs.dsConfig.dMaxMonthes,a+1);console.log(sbModJs.msgHdr,"sbModJs_CalcMaxDate():","maxDate:",b);return b}
function sbModJs_vizualizeDeliveryTimeSlot(){var a=document.querySelector(".ec-form__cell--sbMod_deliverySlot input");if(null==a)console.info(sbModJs.msgHdr,"sbModJs_vizualizeDeliveryTimeSlot():","no deliverySlotInput found, returned");else{var b=a.value;a=parseInt(b);console.info(sbModJs.msgHdr,"sbModJs_vizualizeDeliveryTimeSlot():","slotStart:",a);""===b?a=sbModJs.dsConfig.tplDeliveryTimeSlotEmptyVizualize:(b=a+sbModJs.dsConfig.tSlotDuration,b=23<b?b-24:b,a=sbModJs.dsConfig.tplDeliveryTimeSlotVizualize.replace("{{slotStart}}",
a).replace("{{slotEnd}}",b));$(".ec-form__cell.ec-form__cell--sbMod_deliverySlot .sbModJs_deliverySlotVisualized").html(a);console.log(sbModJs.msgHdr,"sbModJs_vizualizeDeliveryTimeSlot():","formattedSlotString:",a)}}
function sbModJs_IniExtraFields(){ec.order=ec.order||{};ec.order.extraFields=ec.order.extraFields||{};var a=sbModJs_CalcMinDate(),b=sbModJs_CalcMaxDate();ec.order.extraFields.sbMod_deliveryDate={required:!0,type:"datetime",title:sbModJs.dsConfig.dTitle,tip:sbModJs.dsConfig.dTip,checkoutDisplaySection:"shipping_address",orderDetailsDisplaySection:"shipping_info",datePickerOptions:{showTime:!1,minDate:a,maxDate:b}};ec.order.extraFields.sbMod_deliverySlot={required:!0,type:"text",title:sbModJs.dsConfig.tTitle,
tip:sbModJs.dsConfig.tTip,checkoutDisplaySection:"shipping_address",orderDetailsDisplaySection:"shipping_info",value:""+sbModJs.dsConfig.tSlotInitial};Ecwid.refreshConfig();console.log(sbModJs.msgHdr,"sbModJs_IniExtraFields():","done")}
function sbModJs_PrefillAddressData(){var a=typeof Ecwid.Cart,b=typeof Ecwid.Cart.setAddress;"object"==typeof Ecwid&&"object"==a&&"function"==b?(Ecwid.Cart.get(function(a){console.debug(sbModJs.msgHdr,"sbModJs_PrefillAddressData():","cart.shippingPerson before:",a.shippingPerson)}),console.log(sbModJs.msgHdr,"sbModJs_PrefillAddressData():","prefill..."),Ecwid.Cart.setAddress({city:"-",countryCode:"RU",postalCode:"00000",companyName:"-"},function(){console.log(sbModJs.msgHdr,"sbModJs_PrefillAddressData():",
"prefill success")},function(){console.error(sbModJs.msgHdr,"sbModJs_PrefillAddressData():","prefill failed")})):console.log(sbModJs.msgHdr,"sbModJs_PrefillAddressData():","can't prefill")}
$(document).ready(function(){console.log(sbModJs.msgHdr,"document ready");"object"==typeof Ecwid?(console.log(sbModJs.msgHdr,"Ecwid here"),Ecwid.OnAPILoaded.add(function(){console.log(sbModJs.msgHdr,"Ecwid storefront JS API has loaded, ini sequence start");sbModJs.storeId=Ecwid.getOwnerId();console.log(sbModJs.msgHdr,"storeId:",sbModJs.storeId);Ecwid.OnPageLoaded.add(sbModJs_OnPageLoaded);console.log(sbModJs.msgHdr,"sbModJs_OnPageLoaded listener added");Ecwid.OnCartChanged.add(sbModJs_OnCartChanged);
console.log(sbModJs.msgHdr,"sbModJs_OnCartChanged listener added");$(document).on("input",".ec-form__cell--sbMod_deliverySlot input",sbModJs_OnDeliverySlotInput);console.log(sbModJs.msgHdr,"sbModJs_OnDeliverySlotInput listener added");sbModJs_IniExtraFields();sbModJs_PrefillAddressData();console.log(sbModJs.msgHdr,"ini sequence complete")}),console.log(sbModJs.msgHdr,"typeof $:",typeof $,"$.fn.jquery:",$.fn.jquery)):console.error(sbModJs.msgHdr,"no Ecwid here, can't start ini sequence")});
	</script>
	<!-- END sbModJs-0.1.3.* direct code -->
	<h3>sandbox|Shatsky BBQ</h3>
	<div id="dynamic-ec-store" class="hide-ec-dynamic-placeholder" style="display: block;">
		<!-- Ecwid shopping cart plugin v 6.9.7 (partial) -->
		<script data-cfasync="false" type="text/javascript" src="https://app.ecwid.com/script.js?29907195&amp;data_platform=wporg&amp;lang=ru"></script>
		<div id="ecwid-store-29907195" class="ecwid" data-ecwid-default-category-id="0" style="min-height: 400px;">
		<script data-cfasync="false" type="text/javascript"> xProductBrowser("id=ecwid-store-29907195","views=grid(20,3) list(60) table(60)","default_page=");</script>
		<!-- END Ecwid Shopping Cart v 6.9.7 (partial) -->
	</div>
</body>
</html>
